jQuery(document).ready(function(e){function t(){o.is(":checked")?(s.show(),l.prop("required",!0)):(s.hide(),l.prop("required",!1)),c()}function r(){var t=e("tr:not( .hidden )",m),r=e(".check-column.manage-column input.cb-select",f);0===t.length?(v.show(),r.prop("disabled",!0),h.prop("disabled",!0)):(v.hide(),r.prop("disabled",!1)),a(t)}function n(){var t=e("tr:not( .hidden ) input.cb-select:checked",m);0===t.length?h.prop("disabled",!0):h.prop("disabled",!1)}function c(){var t=e("thead th:visible",f).length;e("td.colspanchange",v).prop("colspan",t)}function d(){var t=e("tr:not( .hidden )",m),r=[];return t.each(function(t){var n=e("th input.eddrc-user-id",e(this)).val();n&&r.push(n)}),r}function a(t){return t.length?(t.removeClass("alternate"),void t.each(function(t){e(this).addClass(t%2?"":"alternate")})):!1}function i(e){for(var t=window.location.search.substring(1),r=t.split("&"),n=0;n<r.length;n++){var c=r[n].split("=");if(c[0]===e)return c[1]}return!1}var o=e(".eddrc-active-option"),l=e(".eddrc-pass-option"),s=e(".eddrc-field"),u=e("#eddrc-user-whitelist-select"),p=e("#eddrc-user-whitelist-add"),h=e("#eddrc-user-whitelist-remove-selected"),f=e("#eddrc-user-whitelist-table"),m=e("tbody",f),v=e("tr.eddrc-no-items",m);t(),o.change(function(){t()}),u.select2({placeholder:"Select user",allowClear:!0,minimumInputLength:3,ajax:{url:ajaxurl,dataType:"json",delay:250,data:function(e){return{action:"eddrc_search_users",q:e.term}},processResults:function(t){var r=d().map(Number);return t.forEach(function(t){-1!==e.inArray(t.id,r)&&(t.disabled=!0)}),{results:t}},cache:!0}}),u.on("select2:select",function(e){p.prop("disabled",!1)}),u.on("select2:unselect",function(e){p.prop("disabled",!0)}),p.on("click",function(t){t.preventDefault(),data={action:"eddrc_add_user",user_id:parseInt(u.val(),10),taxonomy:i("taxonomy"),term_id:parseInt(i("tag_ID"),10)},e.get(ajaxurl,data,function(t){t=JSON.parse(t);var c=d().map(Number);if(-1!==e.inArray(t.user_id,c))return!1;var a=e("tr.eddrc-helper",m),i=a.clone();i.removeAttr("class"),e("th input.eddrc-user-id",i).val(t.user_id),e("td.eddrc-name-column span",i).html(t.avatar+" "+t.name),e("td.eddrc-role-column",i).text(t.role),e("td.eddrc-email-column",i).text(t.email),a.after(i),r(),n(),u.select2("val",""),p.prop("disabled",!0)})}),f.on("click","input.cb-select",function(){n()}),h.on("click",function(t){t.preventDefault();var c=e("input.cb-select:checked",m).closest("tr");c.remove(),e("input.cb-select",f).prop("checked",!1),r(),n()}),r(),n(),c(),e(window).resize(function(){c()})});
